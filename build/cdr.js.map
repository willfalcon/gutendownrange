{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/application-form.js","assets/js/cdr.js","assets/js/navbar.js","assets/js/navbarDropdown.js","assets/js/processBullets.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"cdr.js","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","module.exports = () => {\n  function addRow(date) {\n    // param 'date': single custom post type object from wp api\n\n    // get the list field where the camp date options go\n    const datesElem = document.querySelector('tbody.ui-sortable');\n    const dateRow = datesElem.querySelector('tr:last-child');\n    const dateRowInput = dateRow.querySelector('input');\n\n    // copy the last list item that's already there, fill in the camp date title, and stick it in.\n    const newRow = dateRow.cloneNode(true);\n    const newRowInput = newRow.querySelector('input');\n    const addButtons = newRow.querySelector('.gfield_list_icons');\n\n    newRowInput.value = date.title.rendered;\n    newRowInput.setAttribute('readonly', 'true');\n    datesElem.appendChild(newRow);\n\n    // if the item we copied was the empty placeholder, remove it.\n    if (dateRowInput.value == \"\") {\n      datesElem.removeChild(dateRow);\n      // console.log('removed one item');\n    }\n  }\n\n  const appForm = document.querySelector('[data-app-for]');\n\n  if (appForm) {\n    const ageGroupField = document.querySelector('.gfield.age-group .gfield_select');\n    const appFor = appForm.dataset.appFor;\n    if (ageGroupField) {\n      ageGroupField.addEventListener('change', e => {\n        console.log(e);\n        // remove any existing campDate rows, except one, since we need it to make the new ones\n        const datesElem = document.querySelector('tbody.ui-sortable');\n        const allDateRows = datesElem.querySelectorAll('tr:not(:last-child)');\n        allDateRows.forEach(dateRow => datesElem.removeChild(dateRow));\n        // remove this one's value so it'll be removed later\n        const lastDateRowStanding = datesElem.querySelector('tr');\n        lastDateRowStanding.querySelector('input').value = \"\";\n\n        // get the value of the age group selection (the id of the tax term)\n        const termId = e.target.value;\n        // get all the camp dates\n        const endpoint = 'http://www.camp-down-range.org/wp-json/wp/v2/camp_dates?filter[camp_type]=' + appFor;\n        console.log(endpoint);\n        fetch(endpoint)\n          .then(response => response.json())\n          .then(campDates => {\n\n            campDates.forEach(date => {\n              console.log(date);\n              // if the camp date includes the age group that was selected, show it\n              date.age_group.forEach(groupId => {\n                if (groupId == termId) {\n                  addRow(date);\n                }\n              });\n\n            });\n\n        });\n\n      });\n    }\n\n    function numberWithCommas(x) {\n      return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n    }\n\n    // Add a slider that populates the household income number field.\n\n    const incomeContainer = document.querySelector('.household-income .ginput_container_number');\n    if (incomeContainer) {\n      const incomeField = document.querySelector('.household-income .ginput_container_number input');\n      // Create the slider.\n      const incomeSlider = document.createElement('INPUT');\n      incomeSlider.setAttribute('type', 'range');\n      incomeSlider.setAttribute('id', 'incomeSlider');\n      incomeSlider.classList.add('income-slider');\n      incomeSlider.setAttribute('min', '40000');\n      incomeSlider.setAttribute('max', '150000');\n      incomeSlider.setAttribute('step', '1000');\n      incomeSlider.setAttribute('value', '40000');\n      // Insert the slider.\n      incomeContainer.appendChild(incomeSlider);\n      // Make the income field read-only.\n      incomeField.setAttribute('readonly', 'true');\n      incomeField.classList.add('income-field');\n      incomeField.setAttribute('value', '$' + numberWithCommas(40000));\n\n      // When slider is changed, update the income field's value and the cost.\n\n      // Get the cost field.\n      const costField = document.querySelector('.gfield.cost .ginput_container_number input');\n\n      costField.setAttribute('readonly', 'true');\n\n      function updateCost() {\n        let cost;\n        if (incomeSlider.value < 50000) {\n          cost = 50;\n        } else if (incomeSlider.value < 75000 && incomeSlider.value >= 50000) {\n          cost = 150;\n        } else if (incomeSlider.value < 100000 && incomeSlider.value >= 75000) {\n          cost = 250;\n        } else if (incomeSlider.value < 125000 && incomeSlider.value >= 100000) {\n          cost = 350;\n        } else if (incomeSlider.value >= 125000) {\n          cost = 450;\n        }\n        costField.value = '$' + cost.toString();\n      }\n\n      function updateIncome() {\n        incomeField.value = '$' + numberWithCommas(incomeSlider.value);\n        updateCost();\n      }\n      incomeSlider.addEventListener('change', updateIncome);\n      incomeSlider.addEventListener('mousemove', updateIncome);\n\n    }\n\n  }\n}\n","const navbar = require('./navbar.js');\nconst navbarDropdown = require('./navbarDropdown.js');\nconst processBullets = require('./processBullets.js');\nconst appForm = require('./application-form.js');\n\nnavbar();\nnavbarDropdown();\nprocessBullets();\nappForm();\n\nwindow.addEventListener('resize', processBullets, false);\n\n\nfunction isInViewport(el) {\n\n    //special bonus for those using jQuery\n    if (typeof jQuery === \"function\" && el instanceof jQuery) {\n        el = el[0];\n    }\n\n    var rect = el.getBoundingClientRect();\n\n    return (\n        rect.top >= 0 &&\n        rect.left >= 0 &&\n        rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) && /*or $(window).height() */\n        rect.right <= (window.innerWidth || document.documentElement.clientWidth) /*or $(window).width() */\n    );\n}\n\nvar slideDown = document.querySelectorAll('.slide-down');\nvar slideRight = document.querySelectorAll('.slide-right');\n\nfunction tryToSlide() {\n\n  slideDown.forEach(item => {\n    if (isInViewport(item)) {\n      item.classList.add('show');\n    }\n  });\n\n  slideRight.forEach(item => {\n    if (isInViewport(item)) {\n      item.classList.add('show');\n    }\n  });\n\n}\n\nwindow.addEventListener('scroll', tryToSlide, false);\n\ntryToSlide();\n\n\n\n\n\nfunction setCookie(cname, cvalue, hours) {\n  // Sets a cookie. Any cookie really, but for the purposes of the alert bar,\n  // it gets the current date, adds 24 hours to it, then sets the cookie name \"alertClosed\"\n  // to \"true\", sets expiration to 24 hours from now, and sets the path to \"/\",\n  // which makes the cookie apply to all pages on the domain.\n  var d = new Date();\n  d.setTime(d.getTime() + (hours * 24 * 60 * 60 * 1000));\n  var expires = \"expires=\"+d.toUTCString();\n  document.cookie = cname + \"=\" + cvalue + \";\" + expires + \";path=/\";\n}\n\nfunction getCookie(cname) {\n  // Explaination copied from w3schools: (https://www.w3schools.com/js/js_cookies.asp)\n  // Take the cookiename as parameter (cname).\n  // Create a variable (name) with the text to search for (cname + \"=\").\n  // Decode the cookie string, to handle cookies with special characters, e.g. '$'\n  // Split document.cookie on semicolons into an array called ca (ca = decodedCookie.split(';')).\n  // Loop through the ca array (i = 0; i < ca.length; i++), and read out each value c = ca[i]).\n  // If the cookie is found (c.indexOf(name) == 0), return the value of the cookie (c.substring(name.length, c.length).\n  // If the cookie is not found, return \"\".\n  var name = cname + \"=\";\n  var ca = document.cookie.split(';');\n  for(var i = 0; i < ca.length; i++) {\n    var c = ca[i];\n    while (c.charAt(0) == ' ') {\n        c = c.substring(1);\n    }\n    if (c.indexOf(name) == 0) {\n        return c.substring(name.length, c.length);\n    }\n  }\n  return \"\";\n}\n\n  function checkCookie() {\n    // run getCookie to see if the cookie has been set or not.\n    // Returns the value of the cookie if set, or \"\" if not set.\n    var closed = getCookie(\"alertClosed\");\n    if (closed != \"true\") {\n      var alert = document.querySelector('.alert');\n      alert.style.height = '75px';\n      alert.style.marginBottom = '10px';\n      alert.style.padding = '1rem';\n    }\n  }\n\n    function removeAlert(e) {\n      e.target.removeEventListener('transitionend', removeAlert);\n      e.target.parentNode.removeChild(alert);\n    }\n\n    function hideAlert(alert) {\n      alert.addEventListener('transitionend', removeAlert);\n      alert.style.height = '0px';\n      alert.style.marginBottom = '0px';\n      alert.style.padding = '0rem';\n    }\n    var alertClose = document.querySelector('.alert__dismiss');\n    var alertButton = document.querySelector('.alert__button');\n\n    if (alertClose) {\n      alertClose.addEventListener('click', function() {\n        var alert = alertClose.parentNode;\n        hideAlert(alert);\n        setCookie('alertClosed', 'true', 24);\n      });\n    }\n    if (alertButton) {\n      alertButton.addEventListener('click', function() {\n        setCookie('alertClosed', 'true', 24);\n      });\n    }\n\n\n  // ALERT BAR FUNCTIONALITY //\n  if (document.querySelector('.alert')) {\n    checkCookie();\n  }\n  // When the alert bar is activated, we only want users to have to dismiss it once,\n  // so when it's dismissed, we set a very simple cookie that expires in 24 hours.\n  // ('alertClosed=true')\n  // Function checkCookie (above, inside jQuery(document).ready) runs a function getCookie(cname)\n  // which checks whether the cookie we need has been set.\n  // If not, checkCookie runs the setTimeout function, which will trigger the\n  // alert to appear after the specified amout of time.\n  //\n  // Also below is a click listener on the alert's close button which runs a function\n  // setCookie(cname, cvalue, hours), which does exactly what you think it does.\n","module.exports = () => {\n  var toggler = document.getElementById('navbarToggler');\n  toggler.onclick = function() {\n    var nav = document.getElementById('main_nav');\n    var toggleTR = document.getElementById('toggleTR');\n    var toggleTL = document.getElementById('toggleTL');\n    var toggleBR = document.getElementById('toggleBR');\n    var toggleBL = document.getElementById('toggleBL');\n    var logoDark = document.getElementById('logoDark');\n    var logoLight = document.getElementById('logoLight');\n    if ( toggler.classList.contains('open') ) {\n      nav.style.transform = 'translateY(-100%)';\n      toggler.classList.remove('open');\n      toggler.setAttribute('aria-expanded', false);\n      toggleTR.setAttribute('fill', '#478E41');\n      toggleTL.setAttribute('fill', '#478E41');\n      toggleBR.setAttribute('fill', '#478E41');\n      toggleBL.setAttribute('fill', '#478E41');\n      logoLight.style.opacity = '0';\n      logoDark.style.opacity = '1';\n    } else {\n      nav.style.transform = 'translateY(0)';\n      toggler.classList.add('open');\n      toggler.setAttribute('aria-expanded', true);\n      toggleTR.setAttribute('fill', 'white');\n      toggleTL.setAttribute('fill', 'white');\n      toggleBR.setAttribute('fill', 'white');\n      toggleBL.setAttribute('fill', 'white');\n      logoLight.style.opacity = '1';\n      logoDark.style.opacity = '0';\n    }\n  };\n}\n","module.exports = () => {\n\n\n    //** Drop-Down Sub-Menu Voodoo **//\n\n    // Put the Imperius Curse on the menu on document ready so we can bend it to our will later.\n\n    // Get all menu items with sub menu items.\n    const menuParents = document.querySelectorAll('.menu-item-has-children'); // querySelectorAll has support back to ie9\n\n    // Iterate over those menu items with child sub menus with an index.\n    let i = 0;\n    menuParents.forEach((parent) => {\n      // Each 'parent' here is a primary <li> with class .menu-item-has-children\n      //    The <li> 'parent' will have 2 children\n      //    at index[0], the <a> link to the parent page\n      //    at index[1], a <ul> with class .sub-menu containing the child menu\n      //\n      // Add the caret to the <a> element html inside the <li>\n      const childLink = parent.querySelector('a');\n      const childMenu = parent.querySelector('ul');\n      childLink.innerHTML += ' <i id=subMenuCaret' + i + ' class=\"fa fa-caret-right\"></i>';\n      // Add class 'parent' to the <li> item\n      parent.classList.add('parent');\n      // Add data-child attribute to the <li> item to target the correct sub-menu\n      parent.setAttribute('data-child', 'sub_menu_' + i);\n      // Add an id to the child <ul> sub-menu matching the data-child attr of the parent.\n      childMenu.setAttribute('id', 'sub_menu_' + i);\n      // Get the natural height of the element and store as a data attr for later.\n      // var subMenu = document.getElementById('sub_menu_' + i);\n      const height = window.getComputedStyle(childMenu)['height'];\n      // var caret = document.getElementById('subMenuCaret' + i);\n      childMenu.setAttribute('data-height', height);\n      // collapse menu only if we're mobile.\n      if (document.documentElement.clientWidth < 768) {\n        childMenu.style.height = 0;\n        childMenu.style.opacity = 0;\n        childMenu.style.display = 'none';\n        childLink.setAttribute('data-index', i);\n        childLink.addEventListener('click', function(e) {\n          e.preventDefault();\n          const index = this.getAttribute('data-index');\n          console.log(index);\n          const caret = childLink.querySelector('i');\n          if ( childMenu.classList.contains('open') ) {\n            childMenu.classList.remove('open');\n            childMenu.style.height = 0;\n            childMenu.style.opacity = 0;\n            caret.style.transform = 'rotate(0)';\n            setTimeout(function() {\n              childMenu.style.display = 'none';\n            },250);\n          } else {\n            childMenu.classList.add('open');\n            childMenu.style.display = 'block';\n            caret.style.transform = 'rotate(90deg)';\n            setTimeout(function() {\n              childMenu.style.height = childMenu.getAttribute('data-height');\n              childMenu.style.opacity = 1;\n            },0);\n          }\n        });\n\n      }\n\n      i++;\n      // Mischief managed\n    });\n\n\n    // Time to do some magic on those sub-menus\n    // var menuParents = document.querySelectorAll('.menu-item-has-children'); // (already did this)\n    // Iterate over those menu items with child sub menus.\n    for (var parent of menuParents) {\n\n      parent.addEventListener('mouseenter', function() {\n\n        var child = document.getElementById(this.getAttribute('data-child'));\n        child.classList.add('show');\n\n        function addFlip(i) {\n          child.children[i].classList.add('flip');\n        }\n\n        for (i=0;i<child.children.length;i++) {\n\n          setTimeout(addFlip, i * 80, i);\n\n        }\n\n      });\n\n\n      parent.addEventListener('mouseleave', function() {\n        var child = document.getElementById(this.getAttribute('data-child'));\n\n        function removeFlip(i) {\n          child.children[i].classList.remove('flip');\n        }\n\n        for (i=(child.children.length-1);i>=0;i--) {\n\n          setTimeout(removeFlip, (child.children.length - 1 - i) * 80, i);\n        }\n        setTimeout(function() {\n          child.classList.remove('show');\n        }, child.children.length *80);\n\n\n      });\n    }\n\n}\n","module.exports = () => {\n  var lastElement = false;\n  jQuery(\"br\").remove(\".tempbreak\");\n  jQuery(\".sponsors__list li\").each(function() {\n      jQuery(this).removeClass(\"nobullet\");\n      if (lastElement && lastElement.offset().top != jQuery(this).offset().top) {\n          jQuery(lastElement).addClass(\"nobullet\");\n          jQuery(lastElement).append('<br class=\"tempbreak\" />');\n      }\n      lastElement = jQuery(this);\n  }).last().addClass(\"nobullet\");\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhc3NldHMvanMvYXBwbGljYXRpb24tZm9ybS5qcyIsImFzc2V0cy9qcy9jZHIuanMiLCJhc3NldHMvanMvbmF2YmFyLmpzIiwiYXNzZXRzL2pzL25hdmJhckRyb3Bkb3duLmpzIiwiYXNzZXRzL2pzL3Byb2Nlc3NCdWxsZXRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9cmV0dXJuIGV9KSgpIiwibW9kdWxlLmV4cG9ydHMgPSAoKSA9PiB7XG4gIGZ1bmN0aW9uIGFkZFJvdyhkYXRlKSB7XG4gICAgLy8gcGFyYW0gJ2RhdGUnOiBzaW5nbGUgY3VzdG9tIHBvc3QgdHlwZSBvYmplY3QgZnJvbSB3cCBhcGlcblxuICAgIC8vIGdldCB0aGUgbGlzdCBmaWVsZCB3aGVyZSB0aGUgY2FtcCBkYXRlIG9wdGlvbnMgZ29cbiAgICBjb25zdCBkYXRlc0VsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd0Ym9keS51aS1zb3J0YWJsZScpO1xuICAgIGNvbnN0IGRhdGVSb3cgPSBkYXRlc0VsZW0ucXVlcnlTZWxlY3RvcigndHI6bGFzdC1jaGlsZCcpO1xuICAgIGNvbnN0IGRhdGVSb3dJbnB1dCA9IGRhdGVSb3cucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcblxuICAgIC8vIGNvcHkgdGhlIGxhc3QgbGlzdCBpdGVtIHRoYXQncyBhbHJlYWR5IHRoZXJlLCBmaWxsIGluIHRoZSBjYW1wIGRhdGUgdGl0bGUsIGFuZCBzdGljayBpdCBpbi5cbiAgICBjb25zdCBuZXdSb3cgPSBkYXRlUm93LmNsb25lTm9kZSh0cnVlKTtcbiAgICBjb25zdCBuZXdSb3dJbnB1dCA9IG5ld1Jvdy5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGNvbnN0IGFkZEJ1dHRvbnMgPSBuZXdSb3cucXVlcnlTZWxlY3RvcignLmdmaWVsZF9saXN0X2ljb25zJyk7XG5cbiAgICBuZXdSb3dJbnB1dC52YWx1ZSA9IGRhdGUudGl0bGUucmVuZGVyZWQ7XG4gICAgbmV3Um93SW5wdXQuc2V0QXR0cmlidXRlKCdyZWFkb25seScsICd0cnVlJyk7XG4gICAgZGF0ZXNFbGVtLmFwcGVuZENoaWxkKG5ld1Jvdyk7XG5cbiAgICAvLyBpZiB0aGUgaXRlbSB3ZSBjb3BpZWQgd2FzIHRoZSBlbXB0eSBwbGFjZWhvbGRlciwgcmVtb3ZlIGl0LlxuICAgIGlmIChkYXRlUm93SW5wdXQudmFsdWUgPT0gXCJcIikge1xuICAgICAgZGF0ZXNFbGVtLnJlbW92ZUNoaWxkKGRhdGVSb3cpO1xuICAgICAgLy8gY29uc29sZS5sb2coJ3JlbW92ZWQgb25lIGl0ZW0nKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBhcHBGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtYXBwLWZvcl0nKTtcblxuICBpZiAoYXBwRm9ybSkge1xuICAgIGNvbnN0IGFnZUdyb3VwRmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2ZpZWxkLmFnZS1ncm91cCAuZ2ZpZWxkX3NlbGVjdCcpO1xuICAgIGNvbnN0IGFwcEZvciA9IGFwcEZvcm0uZGF0YXNldC5hcHBGb3I7XG4gICAgaWYgKGFnZUdyb3VwRmllbGQpIHtcbiAgICAgIGFnZUdyb3VwRmllbGQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICAvLyByZW1vdmUgYW55IGV4aXN0aW5nIGNhbXBEYXRlIHJvd3MsIGV4Y2VwdCBvbmUsIHNpbmNlIHdlIG5lZWQgaXQgdG8gbWFrZSB0aGUgbmV3IG9uZXNcbiAgICAgICAgY29uc3QgZGF0ZXNFbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGJvZHkudWktc29ydGFibGUnKTtcbiAgICAgICAgY29uc3QgYWxsRGF0ZVJvd3MgPSBkYXRlc0VsZW0ucXVlcnlTZWxlY3RvckFsbCgndHI6bm90KDpsYXN0LWNoaWxkKScpO1xuICAgICAgICBhbGxEYXRlUm93cy5mb3JFYWNoKGRhdGVSb3cgPT4gZGF0ZXNFbGVtLnJlbW92ZUNoaWxkKGRhdGVSb3cpKTtcbiAgICAgICAgLy8gcmVtb3ZlIHRoaXMgb25lJ3MgdmFsdWUgc28gaXQnbGwgYmUgcmVtb3ZlZCBsYXRlclxuICAgICAgICBjb25zdCBsYXN0RGF0ZVJvd1N0YW5kaW5nID0gZGF0ZXNFbGVtLnF1ZXJ5U2VsZWN0b3IoJ3RyJyk7XG4gICAgICAgIGxhc3REYXRlUm93U3RhbmRpbmcucXVlcnlTZWxlY3RvcignaW5wdXQnKS52YWx1ZSA9IFwiXCI7XG5cbiAgICAgICAgLy8gZ2V0IHRoZSB2YWx1ZSBvZiB0aGUgYWdlIGdyb3VwIHNlbGVjdGlvbiAodGhlIGlkIG9mIHRoZSB0YXggdGVybSlcbiAgICAgICAgY29uc3QgdGVybUlkID0gZS50YXJnZXQudmFsdWU7XG4gICAgICAgIC8vIGdldCBhbGwgdGhlIGNhbXAgZGF0ZXNcbiAgICAgICAgY29uc3QgZW5kcG9pbnQgPSAnaHR0cDovL3d3dy5jYW1wLWRvd24tcmFuZ2Uub3JnL3dwLWpzb24vd3AvdjIvY2FtcF9kYXRlcz9maWx0ZXJbY2FtcF90eXBlXT0nICsgYXBwRm9yO1xuICAgICAgICBjb25zb2xlLmxvZyhlbmRwb2ludCk7XG4gICAgICAgIGZldGNoKGVuZHBvaW50KVxuICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgICAudGhlbihjYW1wRGF0ZXMgPT4ge1xuXG4gICAgICAgICAgICBjYW1wRGF0ZXMuZm9yRWFjaChkYXRlID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0ZSk7XG4gICAgICAgICAgICAgIC8vIGlmIHRoZSBjYW1wIGRhdGUgaW5jbHVkZXMgdGhlIGFnZSBncm91cCB0aGF0IHdhcyBzZWxlY3RlZCwgc2hvdyBpdFxuICAgICAgICAgICAgICBkYXRlLmFnZV9ncm91cC5mb3JFYWNoKGdyb3VwSWQgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChncm91cElkID09IHRlcm1JZCkge1xuICAgICAgICAgICAgICAgICAgYWRkUm93KGRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0pO1xuXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBudW1iZXJXaXRoQ29tbWFzKHgpIHtcbiAgICAgIHJldHVybiB4LnRvU3RyaW5nKCkucmVwbGFjZSgvXFxCKD89KFxcZHszfSkrKD8hXFxkKSkvZywgJywnKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgYSBzbGlkZXIgdGhhdCBwb3B1bGF0ZXMgdGhlIGhvdXNlaG9sZCBpbmNvbWUgbnVtYmVyIGZpZWxkLlxuXG4gICAgY29uc3QgaW5jb21lQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhvdXNlaG9sZC1pbmNvbWUgLmdpbnB1dF9jb250YWluZXJfbnVtYmVyJyk7XG4gICAgaWYgKGluY29tZUNvbnRhaW5lcikge1xuICAgICAgY29uc3QgaW5jb21lRmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaG91c2Vob2xkLWluY29tZSAuZ2lucHV0X2NvbnRhaW5lcl9udW1iZXIgaW5wdXQnKTtcbiAgICAgIC8vIENyZWF0ZSB0aGUgc2xpZGVyLlxuICAgICAgY29uc3QgaW5jb21lU2xpZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnSU5QVVQnKTtcbiAgICAgIGluY29tZVNsaWRlci5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAncmFuZ2UnKTtcbiAgICAgIGluY29tZVNsaWRlci5zZXRBdHRyaWJ1dGUoJ2lkJywgJ2luY29tZVNsaWRlcicpO1xuICAgICAgaW5jb21lU2xpZGVyLmNsYXNzTGlzdC5hZGQoJ2luY29tZS1zbGlkZXInKTtcbiAgICAgIGluY29tZVNsaWRlci5zZXRBdHRyaWJ1dGUoJ21pbicsICc0MDAwMCcpO1xuICAgICAgaW5jb21lU2xpZGVyLnNldEF0dHJpYnV0ZSgnbWF4JywgJzE1MDAwMCcpO1xuICAgICAgaW5jb21lU2xpZGVyLnNldEF0dHJpYnV0ZSgnc3RlcCcsICcxMDAwJyk7XG4gICAgICBpbmNvbWVTbGlkZXIuc2V0QXR0cmlidXRlKCd2YWx1ZScsICc0MDAwMCcpO1xuICAgICAgLy8gSW5zZXJ0IHRoZSBzbGlkZXIuXG4gICAgICBpbmNvbWVDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5jb21lU2xpZGVyKTtcbiAgICAgIC8vIE1ha2UgdGhlIGluY29tZSBmaWVsZCByZWFkLW9ubHkuXG4gICAgICBpbmNvbWVGaWVsZC5zZXRBdHRyaWJ1dGUoJ3JlYWRvbmx5JywgJ3RydWUnKTtcbiAgICAgIGluY29tZUZpZWxkLmNsYXNzTGlzdC5hZGQoJ2luY29tZS1maWVsZCcpO1xuICAgICAgaW5jb21lRmllbGQuc2V0QXR0cmlidXRlKCd2YWx1ZScsICckJyArIG51bWJlcldpdGhDb21tYXMoNDAwMDApKTtcblxuICAgICAgLy8gV2hlbiBzbGlkZXIgaXMgY2hhbmdlZCwgdXBkYXRlIHRoZSBpbmNvbWUgZmllbGQncyB2YWx1ZSBhbmQgdGhlIGNvc3QuXG5cbiAgICAgIC8vIEdldCB0aGUgY29zdCBmaWVsZC5cbiAgICAgIGNvbnN0IGNvc3RGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5nZmllbGQuY29zdCAuZ2lucHV0X2NvbnRhaW5lcl9udW1iZXIgaW5wdXQnKTtcblxuICAgICAgY29zdEZpZWxkLnNldEF0dHJpYnV0ZSgncmVhZG9ubHknLCAndHJ1ZScpO1xuXG4gICAgICBmdW5jdGlvbiB1cGRhdGVDb3N0KCkge1xuICAgICAgICBsZXQgY29zdDtcbiAgICAgICAgaWYgKGluY29tZVNsaWRlci52YWx1ZSA8IDUwMDAwKSB7XG4gICAgICAgICAgY29zdCA9IDUwO1xuICAgICAgICB9IGVsc2UgaWYgKGluY29tZVNsaWRlci52YWx1ZSA8IDc1MDAwICYmIGluY29tZVNsaWRlci52YWx1ZSA+PSA1MDAwMCkge1xuICAgICAgICAgIGNvc3QgPSAxNTA7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5jb21lU2xpZGVyLnZhbHVlIDwgMTAwMDAwICYmIGluY29tZVNsaWRlci52YWx1ZSA+PSA3NTAwMCkge1xuICAgICAgICAgIGNvc3QgPSAyNTA7XG4gICAgICAgIH0gZWxzZSBpZiAoaW5jb21lU2xpZGVyLnZhbHVlIDwgMTI1MDAwICYmIGluY29tZVNsaWRlci52YWx1ZSA+PSAxMDAwMDApIHtcbiAgICAgICAgICBjb3N0ID0gMzUwO1xuICAgICAgICB9IGVsc2UgaWYgKGluY29tZVNsaWRlci52YWx1ZSA+PSAxMjUwMDApIHtcbiAgICAgICAgICBjb3N0ID0gNDUwO1xuICAgICAgICB9XG4gICAgICAgIGNvc3RGaWVsZC52YWx1ZSA9ICckJyArIGNvc3QudG9TdHJpbmcoKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gdXBkYXRlSW5jb21lKCkge1xuICAgICAgICBpbmNvbWVGaWVsZC52YWx1ZSA9ICckJyArIG51bWJlcldpdGhDb21tYXMoaW5jb21lU2xpZGVyLnZhbHVlKTtcbiAgICAgICAgdXBkYXRlQ29zdCgpO1xuICAgICAgfVxuICAgICAgaW5jb21lU2xpZGVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUluY29tZSk7XG4gICAgICBpbmNvbWVTbGlkZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdXBkYXRlSW5jb21lKTtcblxuICAgIH1cblxuICB9XG59XG4iLCJjb25zdCBuYXZiYXIgPSByZXF1aXJlKCcuL25hdmJhci5qcycpO1xuY29uc3QgbmF2YmFyRHJvcGRvd24gPSByZXF1aXJlKCcuL25hdmJhckRyb3Bkb3duLmpzJyk7XG5jb25zdCBwcm9jZXNzQnVsbGV0cyA9IHJlcXVpcmUoJy4vcHJvY2Vzc0J1bGxldHMuanMnKTtcbmNvbnN0IGFwcEZvcm0gPSByZXF1aXJlKCcuL2FwcGxpY2F0aW9uLWZvcm0uanMnKTtcblxubmF2YmFyKCk7XG5uYXZiYXJEcm9wZG93bigpO1xucHJvY2Vzc0J1bGxldHMoKTtcbmFwcEZvcm0oKTtcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHByb2Nlc3NCdWxsZXRzLCBmYWxzZSk7XG5cblxuZnVuY3Rpb24gaXNJblZpZXdwb3J0KGVsKSB7XG5cbiAgICAvL3NwZWNpYWwgYm9udXMgZm9yIHRob3NlIHVzaW5nIGpRdWVyeVxuICAgIGlmICh0eXBlb2YgalF1ZXJ5ID09PSBcImZ1bmN0aW9uXCIgJiYgZWwgaW5zdGFuY2VvZiBqUXVlcnkpIHtcbiAgICAgICAgZWwgPSBlbFswXTtcbiAgICB9XG5cbiAgICB2YXIgcmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgICAgcmVjdC50b3AgPj0gMCAmJlxuICAgICAgICByZWN0LmxlZnQgPj0gMCAmJlxuICAgICAgICByZWN0LmJvdHRvbSA8PSAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpICYmIC8qb3IgJCh3aW5kb3cpLmhlaWdodCgpICovXG4gICAgICAgIHJlY3QucmlnaHQgPD0gKHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkgLypvciAkKHdpbmRvdykud2lkdGgoKSAqL1xuICAgICk7XG59XG5cbnZhciBzbGlkZURvd24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2xpZGUtZG93bicpO1xudmFyIHNsaWRlUmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2xpZGUtcmlnaHQnKTtcblxuZnVuY3Rpb24gdHJ5VG9TbGlkZSgpIHtcblxuICBzbGlkZURvd24uZm9yRWFjaChpdGVtID0+IHtcbiAgICBpZiAoaXNJblZpZXdwb3J0KGl0ZW0pKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICB9XG4gIH0pO1xuXG4gIHNsaWRlUmlnaHQuZm9yRWFjaChpdGVtID0+IHtcbiAgICBpZiAoaXNJblZpZXdwb3J0KGl0ZW0pKSB7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcbiAgICB9XG4gIH0pO1xuXG59XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0cnlUb1NsaWRlLCBmYWxzZSk7XG5cbnRyeVRvU2xpZGUoKTtcblxuXG5cblxuXG5mdW5jdGlvbiBzZXRDb29raWUoY25hbWUsIGN2YWx1ZSwgaG91cnMpIHtcbiAgLy8gU2V0cyBhIGNvb2tpZS4gQW55IGNvb2tpZSByZWFsbHksIGJ1dCBmb3IgdGhlIHB1cnBvc2VzIG9mIHRoZSBhbGVydCBiYXIsXG4gIC8vIGl0IGdldHMgdGhlIGN1cnJlbnQgZGF0ZSwgYWRkcyAyNCBob3VycyB0byBpdCwgdGhlbiBzZXRzIHRoZSBjb29raWUgbmFtZSBcImFsZXJ0Q2xvc2VkXCJcbiAgLy8gdG8gXCJ0cnVlXCIsIHNldHMgZXhwaXJhdGlvbiB0byAyNCBob3VycyBmcm9tIG5vdywgYW5kIHNldHMgdGhlIHBhdGggdG8gXCIvXCIsXG4gIC8vIHdoaWNoIG1ha2VzIHRoZSBjb29raWUgYXBwbHkgdG8gYWxsIHBhZ2VzIG9uIHRoZSBkb21haW4uXG4gIHZhciBkID0gbmV3IERhdGUoKTtcbiAgZC5zZXRUaW1lKGQuZ2V0VGltZSgpICsgKGhvdXJzICogMjQgKiA2MCAqIDYwICogMTAwMCkpO1xuICB2YXIgZXhwaXJlcyA9IFwiZXhwaXJlcz1cIitkLnRvVVRDU3RyaW5nKCk7XG4gIGRvY3VtZW50LmNvb2tpZSA9IGNuYW1lICsgXCI9XCIgKyBjdmFsdWUgKyBcIjtcIiArIGV4cGlyZXMgKyBcIjtwYXRoPS9cIjtcbn1cblxuZnVuY3Rpb24gZ2V0Q29va2llKGNuYW1lKSB7XG4gIC8vIEV4cGxhaW5hdGlvbiBjb3BpZWQgZnJvbSB3M3NjaG9vbHM6IChodHRwczovL3d3dy53M3NjaG9vbHMuY29tL2pzL2pzX2Nvb2tpZXMuYXNwKVxuICAvLyBUYWtlIHRoZSBjb29raWVuYW1lIGFzIHBhcmFtZXRlciAoY25hbWUpLlxuICAvLyBDcmVhdGUgYSB2YXJpYWJsZSAobmFtZSkgd2l0aCB0aGUgdGV4dCB0byBzZWFyY2ggZm9yIChjbmFtZSArIFwiPVwiKS5cbiAgLy8gRGVjb2RlIHRoZSBjb29raWUgc3RyaW5nLCB0byBoYW5kbGUgY29va2llcyB3aXRoIHNwZWNpYWwgY2hhcmFjdGVycywgZS5nLiAnJCdcbiAgLy8gU3BsaXQgZG9jdW1lbnQuY29va2llIG9uIHNlbWljb2xvbnMgaW50byBhbiBhcnJheSBjYWxsZWQgY2EgKGNhID0gZGVjb2RlZENvb2tpZS5zcGxpdCgnOycpKS5cbiAgLy8gTG9vcCB0aHJvdWdoIHRoZSBjYSBhcnJheSAoaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKyksIGFuZCByZWFkIG91dCBlYWNoIHZhbHVlIGMgPSBjYVtpXSkuXG4gIC8vIElmIHRoZSBjb29raWUgaXMgZm91bmQgKGMuaW5kZXhPZihuYW1lKSA9PSAwKSwgcmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGUgY29va2llIChjLnN1YnN0cmluZyhuYW1lLmxlbmd0aCwgYy5sZW5ndGgpLlxuICAvLyBJZiB0aGUgY29va2llIGlzIG5vdCBmb3VuZCwgcmV0dXJuIFwiXCIuXG4gIHZhciBuYW1lID0gY25hbWUgKyBcIj1cIjtcbiAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gIGZvcih2YXIgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykge1xuICAgIHZhciBjID0gY2FbaV07XG4gICAgd2hpbGUgKGMuY2hhckF0KDApID09ICcgJykge1xuICAgICAgICBjID0gYy5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIGlmIChjLmluZGV4T2YobmFtZSkgPT0gMCkge1xuICAgICAgICByZXR1cm4gYy5zdWJzdHJpbmcobmFtZS5sZW5ndGgsIGMubGVuZ3RoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFwiXCI7XG59XG5cbiAgZnVuY3Rpb24gY2hlY2tDb29raWUoKSB7XG4gICAgLy8gcnVuIGdldENvb2tpZSB0byBzZWUgaWYgdGhlIGNvb2tpZSBoYXMgYmVlbiBzZXQgb3Igbm90LlxuICAgIC8vIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBjb29raWUgaWYgc2V0LCBvciBcIlwiIGlmIG5vdCBzZXQuXG4gICAgdmFyIGNsb3NlZCA9IGdldENvb2tpZShcImFsZXJ0Q2xvc2VkXCIpO1xuICAgIGlmIChjbG9zZWQgIT0gXCJ0cnVlXCIpIHtcbiAgICAgIHZhciBhbGVydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hbGVydCcpO1xuICAgICAgYWxlcnQuc3R5bGUuaGVpZ2h0ID0gJzc1cHgnO1xuICAgICAgYWxlcnQuc3R5bGUubWFyZ2luQm90dG9tID0gJzEwcHgnO1xuICAgICAgYWxlcnQuc3R5bGUucGFkZGluZyA9ICcxcmVtJztcbiAgICB9XG4gIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZUFsZXJ0KGUpIHtcbiAgICAgIGUudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCByZW1vdmVBbGVydCk7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGFsZXJ0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlQWxlcnQoYWxlcnQpIHtcbiAgICAgIGFsZXJ0LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lbmQnLCByZW1vdmVBbGVydCk7XG4gICAgICBhbGVydC5zdHlsZS5oZWlnaHQgPSAnMHB4JztcbiAgICAgIGFsZXJ0LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICcwcHgnO1xuICAgICAgYWxlcnQuc3R5bGUucGFkZGluZyA9ICcwcmVtJztcbiAgICB9XG4gICAgdmFyIGFsZXJ0Q2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxlcnRfX2Rpc21pc3MnKTtcbiAgICB2YXIgYWxlcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWxlcnRfX2J1dHRvbicpO1xuXG4gICAgaWYgKGFsZXJ0Q2xvc2UpIHtcbiAgICAgIGFsZXJ0Q2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFsZXJ0ID0gYWxlcnRDbG9zZS5wYXJlbnROb2RlO1xuICAgICAgICBoaWRlQWxlcnQoYWxlcnQpO1xuICAgICAgICBzZXRDb29raWUoJ2FsZXJ0Q2xvc2VkJywgJ3RydWUnLCAyNCk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGFsZXJ0QnV0dG9uKSB7XG4gICAgICBhbGVydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZXRDb29raWUoJ2FsZXJ0Q2xvc2VkJywgJ3RydWUnLCAyNCk7XG4gICAgICB9KTtcbiAgICB9XG5cblxuICAvLyBBTEVSVCBCQVIgRlVOQ1RJT05BTElUWSAvL1xuICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFsZXJ0JykpIHtcbiAgICBjaGVja0Nvb2tpZSgpO1xuICB9XG4gIC8vIFdoZW4gdGhlIGFsZXJ0IGJhciBpcyBhY3RpdmF0ZWQsIHdlIG9ubHkgd2FudCB1c2VycyB0byBoYXZlIHRvIGRpc21pc3MgaXQgb25jZSxcbiAgLy8gc28gd2hlbiBpdCdzIGRpc21pc3NlZCwgd2Ugc2V0IGEgdmVyeSBzaW1wbGUgY29va2llIHRoYXQgZXhwaXJlcyBpbiAyNCBob3Vycy5cbiAgLy8gKCdhbGVydENsb3NlZD10cnVlJylcbiAgLy8gRnVuY3Rpb24gY2hlY2tDb29raWUgKGFib3ZlLCBpbnNpZGUgalF1ZXJ5KGRvY3VtZW50KS5yZWFkeSkgcnVucyBhIGZ1bmN0aW9uIGdldENvb2tpZShjbmFtZSlcbiAgLy8gd2hpY2ggY2hlY2tzIHdoZXRoZXIgdGhlIGNvb2tpZSB3ZSBuZWVkIGhhcyBiZWVuIHNldC5cbiAgLy8gSWYgbm90LCBjaGVja0Nvb2tpZSBydW5zIHRoZSBzZXRUaW1lb3V0IGZ1bmN0aW9uLCB3aGljaCB3aWxsIHRyaWdnZXIgdGhlXG4gIC8vIGFsZXJ0IHRvIGFwcGVhciBhZnRlciB0aGUgc3BlY2lmaWVkIGFtb3V0IG9mIHRpbWUuXG4gIC8vXG4gIC8vIEFsc28gYmVsb3cgaXMgYSBjbGljayBsaXN0ZW5lciBvbiB0aGUgYWxlcnQncyBjbG9zZSBidXR0b24gd2hpY2ggcnVucyBhIGZ1bmN0aW9uXG4gIC8vIHNldENvb2tpZShjbmFtZSwgY3ZhbHVlLCBob3VycyksIHdoaWNoIGRvZXMgZXhhY3RseSB3aGF0IHlvdSB0aGluayBpdCBkb2VzLlxuIiwibW9kdWxlLmV4cG9ydHMgPSAoKSA9PiB7XG4gIHZhciB0b2dnbGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdmJhclRvZ2dsZXInKTtcbiAgdG9nZ2xlci5vbmNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG5hdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluX25hdicpO1xuICAgIHZhciB0b2dnbGVUUiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVUUicpO1xuICAgIHZhciB0b2dnbGVUTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVUTCcpO1xuICAgIHZhciB0b2dnbGVCUiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVCUicpO1xuICAgIHZhciB0b2dnbGVCTCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVCTCcpO1xuICAgIHZhciBsb2dvRGFyayA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvRGFyaycpO1xuICAgIHZhciBsb2dvTGlnaHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nb0xpZ2h0Jyk7XG4gICAgaWYgKCB0b2dnbGVyLmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpICkge1xuICAgICAgbmF2LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKC0xMDAlKSc7XG4gICAgICB0b2dnbGVyLmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcbiAgICAgIHRvZ2dsZXIuc2V0QXR0cmlidXRlKCdhcmlhLWV4cGFuZGVkJywgZmFsc2UpO1xuICAgICAgdG9nZ2xlVFIuc2V0QXR0cmlidXRlKCdmaWxsJywgJyM0NzhFNDEnKTtcbiAgICAgIHRvZ2dsZVRMLnNldEF0dHJpYnV0ZSgnZmlsbCcsICcjNDc4RTQxJyk7XG4gICAgICB0b2dnbGVCUi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnIzQ3OEU0MScpO1xuICAgICAgdG9nZ2xlQkwuc2V0QXR0cmlidXRlKCdmaWxsJywgJyM0NzhFNDEnKTtcbiAgICAgIGxvZ29MaWdodC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICAgICAgbG9nb0Rhcmsuc3R5bGUub3BhY2l0eSA9ICcxJztcbiAgICB9IGVsc2Uge1xuICAgICAgbmF2LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVZKDApJztcbiAgICAgIHRvZ2dsZXIuY2xhc3NMaXN0LmFkZCgnb3BlbicpO1xuICAgICAgdG9nZ2xlci5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCB0cnVlKTtcbiAgICAgIHRvZ2dsZVRSLnNldEF0dHJpYnV0ZSgnZmlsbCcsICd3aGl0ZScpO1xuICAgICAgdG9nZ2xlVEwuc2V0QXR0cmlidXRlKCdmaWxsJywgJ3doaXRlJyk7XG4gICAgICB0b2dnbGVCUi5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnd2hpdGUnKTtcbiAgICAgIHRvZ2dsZUJMLnNldEF0dHJpYnV0ZSgnZmlsbCcsICd3aGl0ZScpO1xuICAgICAgbG9nb0xpZ2h0LnN0eWxlLm9wYWNpdHkgPSAnMSc7XG4gICAgICBsb2dvRGFyay5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuICAgIH1cbiAgfTtcbn1cbiIsIm1vZHVsZS5leHBvcnRzID0gKCkgPT4ge1xuXG5cbiAgICAvLyoqIERyb3AtRG93biBTdWItTWVudSBWb29kb28gKiovL1xuXG4gICAgLy8gUHV0IHRoZSBJbXBlcml1cyBDdXJzZSBvbiB0aGUgbWVudSBvbiBkb2N1bWVudCByZWFkeSBzbyB3ZSBjYW4gYmVuZCBpdCB0byBvdXIgd2lsbCBsYXRlci5cblxuICAgIC8vIEdldCBhbGwgbWVudSBpdGVtcyB3aXRoIHN1YiBtZW51IGl0ZW1zLlxuICAgIGNvbnN0IG1lbnVQYXJlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtaXRlbS1oYXMtY2hpbGRyZW4nKTsgLy8gcXVlcnlTZWxlY3RvckFsbCBoYXMgc3VwcG9ydCBiYWNrIHRvIGllOVxuXG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRob3NlIG1lbnUgaXRlbXMgd2l0aCBjaGlsZCBzdWIgbWVudXMgd2l0aCBhbiBpbmRleC5cbiAgICBsZXQgaSA9IDA7XG4gICAgbWVudVBhcmVudHMuZm9yRWFjaCgocGFyZW50KSA9PiB7XG4gICAgICAvLyBFYWNoICdwYXJlbnQnIGhlcmUgaXMgYSBwcmltYXJ5IDxsaT4gd2l0aCBjbGFzcyAubWVudS1pdGVtLWhhcy1jaGlsZHJlblxuICAgICAgLy8gICAgVGhlIDxsaT4gJ3BhcmVudCcgd2lsbCBoYXZlIDIgY2hpbGRyZW5cbiAgICAgIC8vICAgIGF0IGluZGV4WzBdLCB0aGUgPGE+IGxpbmsgdG8gdGhlIHBhcmVudCBwYWdlXG4gICAgICAvLyAgICBhdCBpbmRleFsxXSwgYSA8dWw+IHdpdGggY2xhc3MgLnN1Yi1tZW51IGNvbnRhaW5pbmcgdGhlIGNoaWxkIG1lbnVcbiAgICAgIC8vXG4gICAgICAvLyBBZGQgdGhlIGNhcmV0IHRvIHRoZSA8YT4gZWxlbWVudCBodG1sIGluc2lkZSB0aGUgPGxpPlxuICAgICAgY29uc3QgY2hpbGRMaW5rID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICAgIGNvbnN0IGNoaWxkTWVudSA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCd1bCcpO1xuICAgICAgY2hpbGRMaW5rLmlubmVySFRNTCArPSAnIDxpIGlkPXN1Yk1lbnVDYXJldCcgKyBpICsgJyBjbGFzcz1cImZhIGZhLWNhcmV0LXJpZ2h0XCI+PC9pPic7XG4gICAgICAvLyBBZGQgY2xhc3MgJ3BhcmVudCcgdG8gdGhlIDxsaT4gaXRlbVxuICAgICAgcGFyZW50LmNsYXNzTGlzdC5hZGQoJ3BhcmVudCcpO1xuICAgICAgLy8gQWRkIGRhdGEtY2hpbGQgYXR0cmlidXRlIHRvIHRoZSA8bGk+IGl0ZW0gdG8gdGFyZ2V0IHRoZSBjb3JyZWN0IHN1Yi1tZW51XG4gICAgICBwYXJlbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNoaWxkJywgJ3N1Yl9tZW51XycgKyBpKTtcbiAgICAgIC8vIEFkZCBhbiBpZCB0byB0aGUgY2hpbGQgPHVsPiBzdWItbWVudSBtYXRjaGluZyB0aGUgZGF0YS1jaGlsZCBhdHRyIG9mIHRoZSBwYXJlbnQuXG4gICAgICBjaGlsZE1lbnUuc2V0QXR0cmlidXRlKCdpZCcsICdzdWJfbWVudV8nICsgaSk7XG4gICAgICAvLyBHZXQgdGhlIG5hdHVyYWwgaGVpZ2h0IG9mIHRoZSBlbGVtZW50IGFuZCBzdG9yZSBhcyBhIGRhdGEgYXR0ciBmb3IgbGF0ZXIuXG4gICAgICAvLyB2YXIgc3ViTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJfbWVudV8nICsgaSk7XG4gICAgICBjb25zdCBoZWlnaHQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShjaGlsZE1lbnUpWydoZWlnaHQnXTtcbiAgICAgIC8vIHZhciBjYXJldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJNZW51Q2FyZXQnICsgaSk7XG4gICAgICBjaGlsZE1lbnUuc2V0QXR0cmlidXRlKCdkYXRhLWhlaWdodCcsIGhlaWdodCk7XG4gICAgICAvLyBjb2xsYXBzZSBtZW51IG9ubHkgaWYgd2UncmUgbW9iaWxlLlxuICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA8IDc2OCkge1xuICAgICAgICBjaGlsZE1lbnUuc3R5bGUuaGVpZ2h0ID0gMDtcbiAgICAgICAgY2hpbGRNZW51LnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgICBjaGlsZE1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgY2hpbGRMaW5rLnNldEF0dHJpYnV0ZSgnZGF0YS1pbmRleCcsIGkpO1xuICAgICAgICBjaGlsZExpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaW5kZXgnKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhpbmRleCk7XG4gICAgICAgICAgY29uc3QgY2FyZXQgPSBjaGlsZExpbmsucXVlcnlTZWxlY3RvcignaScpO1xuICAgICAgICAgIGlmICggY2hpbGRNZW51LmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpICkge1xuICAgICAgICAgICAgY2hpbGRNZW51LmNsYXNzTGlzdC5yZW1vdmUoJ29wZW4nKTtcbiAgICAgICAgICAgIGNoaWxkTWVudS5zdHlsZS5oZWlnaHQgPSAwO1xuICAgICAgICAgICAgY2hpbGRNZW51LnN0eWxlLm9wYWNpdHkgPSAwO1xuICAgICAgICAgICAgY2FyZXQuc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgwKSc7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBjaGlsZE1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIH0sMjUwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2hpbGRNZW51LmNsYXNzTGlzdC5hZGQoJ29wZW4nKTtcbiAgICAgICAgICAgIGNoaWxkTWVudS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcbiAgICAgICAgICAgIGNhcmV0LnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoOTBkZWcpJztcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGNoaWxkTWVudS5zdHlsZS5oZWlnaHQgPSBjaGlsZE1lbnUuZ2V0QXR0cmlidXRlKCdkYXRhLWhlaWdodCcpO1xuICAgICAgICAgICAgICBjaGlsZE1lbnUuc3R5bGUub3BhY2l0eSA9IDE7XG4gICAgICAgICAgICB9LDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgIH1cblxuICAgICAgaSsrO1xuICAgICAgLy8gTWlzY2hpZWYgbWFuYWdlZFxuICAgIH0pO1xuXG5cbiAgICAvLyBUaW1lIHRvIGRvIHNvbWUgbWFnaWMgb24gdGhvc2Ugc3ViLW1lbnVzXG4gICAgLy8gdmFyIG1lbnVQYXJlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnUtaXRlbS1oYXMtY2hpbGRyZW4nKTsgLy8gKGFscmVhZHkgZGlkIHRoaXMpXG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRob3NlIG1lbnUgaXRlbXMgd2l0aCBjaGlsZCBzdWIgbWVudXMuXG4gICAgZm9yICh2YXIgcGFyZW50IG9mIG1lbnVQYXJlbnRzKSB7XG5cbiAgICAgIHBhcmVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWVudGVyJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIGNoaWxkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtY2hpbGQnKSk7XG4gICAgICAgIGNoaWxkLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTtcblxuICAgICAgICBmdW5jdGlvbiBhZGRGbGlwKGkpIHtcbiAgICAgICAgICBjaGlsZC5jaGlsZHJlbltpXS5jbGFzc0xpc3QuYWRkKCdmbGlwJyk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGk9MDtpPGNoaWxkLmNoaWxkcmVuLmxlbmd0aDtpKyspIHtcblxuICAgICAgICAgIHNldFRpbWVvdXQoYWRkRmxpcCwgaSAqIDgwLCBpKTtcblxuICAgICAgICB9XG5cbiAgICAgIH0pO1xuXG5cbiAgICAgIHBhcmVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjaGlsZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuZ2V0QXR0cmlidXRlKCdkYXRhLWNoaWxkJykpO1xuXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZUZsaXAoaSkge1xuICAgICAgICAgIGNoaWxkLmNoaWxkcmVuW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2ZsaXAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAoaT0oY2hpbGQuY2hpbGRyZW4ubGVuZ3RoLTEpO2k+PTA7aS0tKSB7XG5cbiAgICAgICAgICBzZXRUaW1lb3V0KHJlbW92ZUZsaXAsIChjaGlsZC5jaGlsZHJlbi5sZW5ndGggLSAxIC0gaSkgKiA4MCwgaSk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBjaGlsZC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7XG4gICAgICAgIH0sIGNoaWxkLmNoaWxkcmVuLmxlbmd0aCAqODApO1xuXG5cbiAgICAgIH0pO1xuICAgIH1cblxufVxuIiwibW9kdWxlLmV4cG9ydHMgPSAoKSA9PiB7XG4gIHZhciBsYXN0RWxlbWVudCA9IGZhbHNlO1xuICBqUXVlcnkoXCJiclwiKS5yZW1vdmUoXCIudGVtcGJyZWFrXCIpO1xuICBqUXVlcnkoXCIuc3BvbnNvcnNfX2xpc3QgbGlcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIGpRdWVyeSh0aGlzKS5yZW1vdmVDbGFzcyhcIm5vYnVsbGV0XCIpO1xuICAgICAgaWYgKGxhc3RFbGVtZW50ICYmIGxhc3RFbGVtZW50Lm9mZnNldCgpLnRvcCAhPSBqUXVlcnkodGhpcykub2Zmc2V0KCkudG9wKSB7XG4gICAgICAgICAgalF1ZXJ5KGxhc3RFbGVtZW50KS5hZGRDbGFzcyhcIm5vYnVsbGV0XCIpO1xuICAgICAgICAgIGpRdWVyeShsYXN0RWxlbWVudCkuYXBwZW5kKCc8YnIgY2xhc3M9XCJ0ZW1wYnJlYWtcIiAvPicpO1xuICAgICAgfVxuICAgICAgbGFzdEVsZW1lbnQgPSBqUXVlcnkodGhpcyk7XG4gIH0pLmxhc3QoKS5hZGRDbGFzcyhcIm5vYnVsbGV0XCIpO1xufVxuIl19"}